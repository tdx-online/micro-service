apiVersion: v1
data:
  nginx.conf: "events {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream user_service {\n        server user-service:8082;\n#         server <User_Service_IP2>:<User_Service_Port2>;  # 如果有多个实例，可以添加更多的服务器\n    }\n\n    upstream product_service {\n        server product-service:8081;\n#         server <Product_Service_IP2>:<Product_Service_Port2>;  # 如果有多个实例，可以添加更多的服务器\n    }\n\n    server {\n        listen 80;\n\n        location /user/ {\n            proxy_pass http://user_service/user/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /cart/ {\n            proxy_pass http://user_service/cart/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /order/ {\n            proxy_pass http://user_service/order/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /category/ {\n            proxy_pass http://product_service/category/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /product/ {\n            proxy_pass http://product_service/product/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n#             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /property/ {\n            proxy_pass http://product_service/property/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /comment/ {\n            proxy_pass http://product_service/comment/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /upload/ {\n            proxy_pass http://product_service/upload/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            #             # 添加CORS头\n#                          add_header 'Access-Control-Allow-Origin' 'http://localhost:23620' always;\n#                          add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS always;\n#                          add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token always;\n#                          add_header Access-Control-Allow-Credentials true always;\n#                          add_header 'Access-Control-Max-Age' 86400;\n#              \n#                          # 如果请求方法为OPTIONS，直接返回204\n#                          if ($request_method = 'OPTIONS') {\n#                              return 204;\n#                          }\n        }\n\n        location /nginx_status {\n            stub_status on;\n            allow all;\n        }\n    }\n}"
kind: ConfigMap
metadata:
  annotations:
    use-subpath: "true"
  labels:
    io.kompose.service: nginx
  name: nginx-cm0
